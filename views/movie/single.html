{% extends "layouts/base.html" %}
{% block body %}
<section data-scroll-section class="post-content">
    <div class="container d-flex flex-column">
        <?php if ($movie['trailer_link'] != NULL) { ?>
            <div class="videoSection p-0 mb-3">
                <div class="video">
                    <iframe title="YouTube Video" class="w-100 h-100"
                        src="{{movie.trailer_link}}"></iframe>
                </div>
            </div>
        <?php } ?>
        <div id = "single_movie_deets" class="w-100 d-flex row mt-3 px-0 justify-between">
            <div class="col-xl-6 col-lg-6 col-12 d-flex flex-column">
                <h1 class="display-1">
                    {{movie.name}}
                </h1>
                <p class="mt-3">
                    {{movie.synopsis}}
                </p>
                <div class="mt-1 d-flex flex-column w-50">
                    <div class="d-flex align-center mb-3">
                        {% if (movie.average_rating) %}
                            {%for i in range(1, movie.average_rating | int + 1)%}
                                <img style="width:20px; height: 20px;" class="mr-2" src="{{url_for('static', filename = 'star.png') }}" alt="poster">
                            {%endfor%}
                        {%endif%}
                    </div>

                    <!-- <div>
                        <?php if (isset($_SESSION['user_id'])) { ?>
                            <?php if ($check->num_rows == 0) { ?>
                                <?php if (isset($_SESSION['cart_items'][$movie['id']])) { ?>
                                    <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">Movie
                                        already in cart</a>
                                <?php } else { ?>
                                    <a href="/user/cart.php?movie_id=<?php echo $movie['id'] ?>"
                                        class="px-5 py-3 btn btn-primary">Rent
                                        now
                                        for $
                                        <?php echo $movie['price'] ?>
                                    </a>
                                <?php } ?>
                            <?php } else { ?>
                                <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">You
                                    have already rented this!</a>
                            <?php } ?>
                        <?php } else { ?>
                            <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">Please
                                log in or register to rent</a>
                        <?php } ?>
                    </div> -->

                </div>
                <div class="directed mt-4 d-flex justify-content-between">
                    <!-- <div>
                        <h2><strong>DIRECTOR</strong></h2>
                        <div>
                            <h3>
                                <?php echo $movie['directors'] ?>
                            </h3>
                        </div>
                    </div> -->
                    <div>
                        <h2><strong>RELEASED</strong></h2>
                        <div>
                            <h3>
                                {{movie.release_date}}
                            </h3>
                        </div>
                    </div>
                </div>

                <div class="genres mt-5 d-flex justify-content-between">
                    <div>
                        <h2><strong>GENRES</strong></h2>
                        <h3>
                            {{movie.genres}}
                        </h3>
                    </div>

                    <div>
                        <h2><strong>Run Time</strong></h2>
                        <h3>
                            {{movie.runtime}} Minutes
                        </h3>
                    </div>
                </div>
            </div>
            <div class="col-xl-6 col-lg-6 col-12 d-flex flex-column">
                <div class="movie-image d-flex justify-content-end align-items-center">
                    <img class="w-75" src="{{url_for('static', filename = 'posters/' + movie.image_url) }}" alt="movie-poster">
                </div>
            </div>
        </div>

        <div data-scroll class="mt-5 container full-width d-flex flex-wrap p-0">
            <div class="full-width">
                <h1 class="display-6"><strong>Reviews</strong></h1>
            </div>

                <div class="full-width mb-3">
                    <p><strong>Add review</strong></p>
                    <form method="post" action="/php_processes/addReview.php" class="form-group review-form" style="width: 40%">
                        <input type="hidden" name="movie_id" value="<?php echo $movie['id'] ?>">
                        <label for="rating">Select a rating:</label>
                        <select name="rating" class="form-select mb-2" aria-label="rating">
                            <option value="5">5/5</option>
                            <option value="4">4/5</option>
                            <option value="3">3/5</option>
                            <option value="2">2/5</option>
                            <option value="1">1/5</option>
                        </select>
                        <label for="review">Review:</label>
                        <textarea name="review" aria-label="review" required class="form-control mb-2"
                            rows="3"></textarea>
                        <button type="submit" class="btn btn-primary">Add Review</button>
                    </form>
                </div>
                <div data-scroll class="mt-5 container full-width d-flex flex-wrap flex-row p-0">
                {%for review in reviews %}
                <div class="col-xl-4 col-l-4 col-s-12 col-12 col-md-6 p-0">
                    <div class="card h-100">
                        <div class="card-body mt-2">
                            {%for i in range(1, review.rating + 1) %}
                                <img style="width:20px; height: 20px;" class="mb-1" src="/static/star.png" alt="star">
                            {%endfor%}
                            <p class="card-text">
                                {{review.body}}
                            </p>
                            <p class="card-title">Written by:
                                {{review.user_id}}
                            </p>
                        </div>
                    </div>
                </div>
                {%endfor%}
            </div>
        </div>
    </div>
</section>

{% endblock %}