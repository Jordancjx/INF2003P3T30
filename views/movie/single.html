{% extends "layouts/base.html" %}
{% block body %}
<section data-scroll-section class="post-content">
    <div class="container d-flex flex-column">
        <div id = "single_movie_deets" class="w-100 d-flex row mt-3 px-0 justify-between">
            <div class="col-xl-6 col-lg-6 col-12 d-flex flex-column">
                <h1 class="display-1">
                    {{movie.name}}
                </h1>
                <p class="mt-3">
                    {{movie.synopsis}}
                </p>
                <div class="mt-1 d-flex flex-column w-50">
                    <div class="d-flex align-center mb-3">
                        {% if (movie.average_rating) %}
                            {%for i in range(1, movie.average_rating | int + 1)%}
                                <img style="width:20px; height: 20px;" class="mb-1" src="{{ url_for('static', filename='img/star.png') }}" alt="star">
                            {%endfor%}
                        {%endif%}
                    </div>

                    <!-- <div>
                        <?php if (isset($_SESSION['user_id'])) { ?>
                            <?php if ($check->num_rows == 0) { ?>
                                <?php if (isset($_SESSION['cart_items'][$movie['id']])) { ?>
                                    <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">Movie
                                        already in cart</a>
                                <?php } else { ?>
                                    <a href="/user/cart.php?movie_id=<?php echo $movie['id'] ?>"
                                        class="px-5 py-3 btn btn-primary">Rent
                                        now
                                        for $
                                        <?php echo $movie['price'] ?>
                                    </a>
                                <?php } ?>
                            <?php } else { ?>
                                <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">You
                                    have already rented this!</a>
                            <?php } ?>
                        <?php } else { ?>
                            <a class="btn btn-primary px-5 py-3 disabled" role="button" aria-disabled="true">Please
                                log in or register to rent</a>
                        <?php } ?>
                    </div> -->

                </div>
                <div class="directed mt-4 d-flex justify-content-between">
                    <!-- <div>
                        <h2><strong>DIRECTOR</strong></h2>
                        <div>
                            <h3>
                                <?php echo $movie['directors'] ?>
                            </h3>
                        </div>
                    </div> -->
                    <div>
                        <h2><strong>RELEASED</strong></h2>
                        <div>
                            <h3>
                                {{movie.release_date}}
                                {{movie.price}}
                            </h3>
                        </div>
                        <h2><strong>Price</strong></h2>
                        <div>
                            <h3>
                                $ {{movie.price}}
                            </h3>
                        </div>
                    </div>

                    <div >
                        <!-- Add to cart -->
                        <form action="/orders/api/add" method="POST" class="form-group">
                            <input type="hidden" name="movie_id" value="{{ movie.id }}">
                            <button type="submit" class="btn btn-primary">
                                Add to Cart
                            </button>
                        </form>
                    </div>

                </div>



                <div class="genres mt-5 d-flex justify-content-between">
                    <div>
                        <h2><strong>GENRES</strong></h2>
                        <h3>
                            {{movie.genres}}
                        </h3>
                    </div>

                    <div>
                        <h2><strong>Run Time</strong></h2>
                        <h3>
                            {{movie.runtime}} Minutes
                        </h3>
                    </div>
                </div>



                
            </div>
            <div class="col-xl-6 col-lg-6 col-12 d-flex flex-column">
                <div class="movie-image d-flex justify-content-end align-items-center">
                    <img class="w-75" src="https://image.tmdb.org/t/p/w500{{movie.image_url}}" alt="{{movie.name}}">
                </div>
            </div>
        </div>

        <div data-scroll class="mt-5 container full-width d-flex flex-wrap p-0">
            <div class="full-width">
                <h1 class="display-6"><strong>Reviews</strong></h1>
            </div>
                {% if 'user_id' in session%}
                <div class="full-width mb-3">
                    <p><strong>Add review</strong></p>
                    <form method="post" action="/review/api/add" class="form-group review-form" style="width: 40%">
                        <input type="hidden" name="movie_id" value="{{movie[0]}}">
                        <label for="rating">Select a rating:</label>
                        <select name="rating" class="form-select mb-2" aria-label="rating">
                            <option value="5">5/5</option>
                            <option value="4">4/5</option>
                            <option value="3">3/5</option>
                            <option value="2">2/5</option>
                            <option value="1">1/5</option>
                        </select>
                        <label for="review">Review:</label>
                        <textarea name="review" aria-label="review" required class="form-control mb-2"
                            rows="3"></textarea>
                        <button type="submit" class="btn btn-primary">Add Review</button>
        
                    </form>
                    </div>
                    {% endif %}
                <div data-scroll class="mt-5 container full-width d-flex flex-wrap flex-row p-0">
                {%for review in reviews %}
                <div class="col-xl-4 col-l-4 col-s-12 col-12 col-md-6 p-0">
                    <div class="card h-100">
                        <div class="card-body mt-2">
                            {%for i in range(1, review.rating + 1) %}
                                <img style="width:20px; height: 20px;" class="mb-1" src="{{url_for('static', filename='/img/star.png') }}" alt="star">
                            {%endfor%}

                            <p class="card-text">
                                {{review.body}}
                            </p>
                            <p class="card-title">Written by:
                                {{review.username}}
                            </p>


                             <!-- Add Edit Button -->
                            {% if review.users_id == session.get('user_id') %}
                                <a href="{{ url_for('review.edit', id=review.id) }}" class="btn btn-primary mt-2 ">Edit Review</a>

                                <!-- Delete Form -->
                                <form action="{{ url_for('review.delete', id=review.id) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                    <button type="submit" class="btn btn-danger mt-2" onclick="return confirm('Are you sure you want to delete this review?');">Delete Review</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {%endfor%}
            </div>
        </div>
    </div>
</section>

{% endblock %}